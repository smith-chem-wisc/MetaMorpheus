<Window x:Class="MetaMorpheusGUI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:MetaMorpheusGUI"
        xmlns:guiFunctions="clr-namespace:GuiFunctions;assembly=GuiFunctions"
        xmlns:metaMorpheusGui="clr-namespace:MetaMorpheusGUI;assembly=GuiFunctions"
        mc:Ignorable="d"
        Drop="Window_Drop" AllowDrop="true" 
        Background="{StaticResource BackgroundColor}" 
        WindowStartupLocation="CenterScreen" MinHeight="460" 
        MinWidth="800" Height="550" Width="1000"
        Loaded="MyWindow_Loaded"
        Title="{Binding Source={x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}, Path=MainWindowTitle}"
        Closing="MainWindow_Closing"
        PreviewKeyDown="Window_PreviewKeyDown">

    <Window.Resources>
        <ResourceDictionary>
            <!--App-wide resources (e.g., colors) can be found in App.xaml-->

            <!--Allows use of "not" (i.e., inverse of true boolean) in binding properties-->
            <local:BooleanInverter x:Key="InvertedBooleanConverter" />

            <!--Styling for the context menu to add tasks-->
            <Style x:Key="ContextMenuStyle" TargetType="ContextMenu">
                <Setter Property="Background" Value="{StaticResource BackgroundColor}"/>
                <Setter Property="Foreground" Value="{StaticResource TextColor1}"/>
                <Setter Property="OverridesDefaultStyle" Value="True" />
                <Setter Property="SnapsToDevicePixels" Value="True" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type ContextMenu}">
                            <Border BorderThickness="1" BorderBrush="{StaticResource BorderColor}" x:Name="Border" 
                                    Background="{StaticResource BackgroundColor}">
                                <StackPanel ClipToBounds="True" Orientation="Vertical" IsItemsHost="True" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="true">
                                    <Setter TargetName="Border" Property="Background" Value="{StaticResource BackgroundColor}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            
            <!--Defines the context menu to remove sections of the pre-run setup-->
            <ContextMenu x:Key="BigDeleteContextMenu" Style="{StaticResource ContextMenuStyle}">
                <MenuItem Header="Remove All" Click="DeleteAll" />
                <MenuItem Header="Remove Spectra" Click="DeleteAll_Spectra" />
                <MenuItem Header="Remove Databases" Click="DeleteAll_Databases" />
                <MenuItem Header="Remove Tasks" Click="DeleteAll_Tasks" />
            </ContextMenu>
            
            <Style TargetType="TabControl" x:Key="TabControlStyle">
                <Setter Property="Background" Value="{StaticResource SideBarMainColor}" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="TabControl">
                            <Grid ClipToBounds="true">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <!-- For tab headers -->
                                    <ColumnDefinition Width="*"/>
                                    <!-- For content -->
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Actual Tab Headers -->
                                <TabPanel Grid.Row="0" Grid.Column="0"
                                          Name="HeaderPanel"
                                          IsItemsHost="True"
                                          Margin="0"
                                          KeyboardNavigation.TabIndex="1"
                                          Panel.ZIndex="1"
                                          Background="Transparent"/>

                                <!-- Protein/RNA Toggle Control -->
                                <local:ProteinRnaImageToggle Grid.Row="1" Grid.Column="0" Width="100"/>

                                <!-- Content Panel -->
                                <ContentPresenter
                                    Name="PART_SelectedContentHost"
                                    Margin="4 0 0 0 "
                                    Grid.Row="0"
                                    Grid.RowSpan="2"
                                    Grid.Column="1"
                                    ContentSource="SelectedContent"/>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <DataTrigger Binding="{Binding Source={x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}, Path=IsRnaMode}" Value="True">
                        <Setter Property="Background" Value="{StaticResource RnaSideBarMainColor}"/>
                        <Setter Property="BorderBrush" Value="{StaticResource RnaSideBarMainColor}"/>
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <!--Styling for the tab items on the left side-->
            <Style x:Key="TabItemStyle" TargetType="TabItem">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="BorderThickness" Value="0" />
                <Setter Property="Background" Value="{StaticResource SideBarMainColor}"/>
                <Setter Property="BorderBrush" Value="{StaticResource AccentColor}"/>
                <Setter Property="Margin" Value="0,0,2,0" />
                <Setter Property="Padding" Value="0" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="TabItem">
                            <Grid Height="35" Width="105" Background="{TemplateBinding Background}">
                                <Border Name="Border" Margin="0,0,0,0" Background="Transparent"
                                        BorderThickness="{TemplateBinding BorderThickness}"
                                        BorderBrush="{Binding BorderBrush, RelativeSource={RelativeSource TemplatedParent}}">
                                    <ContentPresenter 
                                        x:Name="ContentSite" 
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left"
                                        ContentSource="Header" Margin="5,2,10,2"
                                        RecognizesAccessKey="True"/>
                                </Border>
                            </Grid>

                            <ControlTemplate.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="BorderThickness" Value="0,0,7,0"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="Foreground" Value="{StaticResource TextColor2}"/>
                                </Trigger>

                                <Trigger Property="IsSelected" Value="False">
                                    <Setter Property="Foreground" Value="{StaticResource TextColor2}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <DataTrigger Binding="{Binding Source={x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}, Path=IsRnaMode}" Value="True">
                        <Setter Property="Background" Value="{DynamicResource RnaSideBarMainColor}"/>
                        <Setter Property="BorderBrush" Value="{DynamicResource RnaAccentColor}"/>
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <!--Styling for the grid that defines each page-->
            <Style x:Key="PageGridStyle" TargetType="Grid">
                <Setter Property="Background" Value="{StaticResource BackgroundColor}"/>
                <Setter Property="Margin" Value="-3,-2,-2,-2"/>
            </Style>

            <!--Styling for the "important" buttons like add task, add DB, etc.-->
            <Style x:Key="ImportantButtonStyle" TargetType="Button">
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Width" Value="200"/>
                <Setter Property="Background" Value="{StaticResource AccentColor}"/>
                <Setter Property="Foreground" Value="{StaticResource TextColor2}"/>
                <Setter Property="FontSize" Value="12"/>
                <Style.Triggers>
                    <DataTrigger Binding="{Binding Source={x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}, Path=IsRnaMode}" Value="True">
                        <Setter Property="Background" Value="{StaticResource RnaAccentColor}" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <!--Styling for the "important" buttons that should disappear in RNA mode-->
            <Style x:Key="ImportantButtonStyleNotForRna" TargetType="Button" BasedOn="{StaticResource ImportantButtonStyle}">
                <Setter Property="Visibility" Value="Visible" />
                <Style.Triggers>
                    <DataTrigger Binding="{Binding Source={x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}, Path=IsRnaMode}" Value="True">
                        <Setter Property="Visibility" Value="Collapsed" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <!--Styling for borders-->
            <Style x:Key="x:BorderStyle" TargetType="Border">
                <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
                <Setter Property="BorderThickness" Value="1"/>
            </Style>

            <!--Styling for the big text header at the top of each page-->
            <Style x:Key="HeaderLabelStyle" TargetType="Label">
                <Setter Property="HorizontalAlignment" Value="Left"/>
                <Setter Property="FontSize" Value="26"/>
                <Setter Property="FontWeight" Value="Bold"/>
                <Setter Property="Foreground" Value="{StaticResource TextColor1}"/>
                <Setter Property="Margin" Value="10,5,0,0"/>
            </Style>

            <!--Styling for the "main" text in the About + Help pages-->
            <Style x:Key="TextBlockStyle" TargetType="TextBlock">
                <Setter Property="Foreground" Value="{StaticResource TextColor1}"/>
                <Setter Property="FontSize" Value="13"/>
                <Setter Property="TextWrapping" Value="WrapWithOverflow" />
                <Setter Property="Margin" Value="15,0,10,0"/>
            </Style>

            <!--Defines the context menu when "add task" button is clicked-->
            <ContextMenu x:Key="AddTaskMenu" Style="{StaticResource ContextMenuStyle}">
                <MenuItem Header="Add new calibration task" Click="AddCalibrateTaskButton_Click" />
                <MenuItem Header="Add new averaging task" Click="AddAveragingTaskButton_OnClick" />
                <MenuItem Header="Add new GPTMD task" Click="AddGPTMDTaskButton_Click" />
                <MenuItem Header="Add new search task" Click="AddSearchTaskButton_Click" />
                <MenuItem Header="Add new crosslink task" Click="AddCrosslinkTask_Click" >
                    <MenuItem.Style>
                        <Style TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Visible"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Source={x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}, Path=IsRnaMode}" Value="True">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>
                </MenuItem>
                <MenuItem Header="Add new glycopeptide task" Click="AddGlycoSearchTask_Click" >
                    <MenuItem.Style>
                        <Style TargetType="MenuItem">
                            <Setter Property="Visibility" Value="Visible"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Source={x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}, Path=IsRnaMode}" Value="True">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>
                </MenuItem>
                <Separator/>
                <MenuItem Header="Load task from .toml file" Click="LoadTask_Click" />
            </ContextMenu>

            <!--Defines the context menu when a protein database is right-clicked-->
            <ContextMenu x:Key="ProteinDatabaseContextMenu" Style="{StaticResource ContextMenuStyle}">
                <MenuItem Header="Set as contaminant database" Click="SetSelectedDatabaseAsContaminant_Click"/>
                <MenuItem Header="Set as non-contaminant database" Click="SetSelectedDatabaseAsNonContaminant_Click"/>
                <MenuItem Header="Open file" Click="OpenFile_Click"/>
                <MenuItem Header="Open containing folder" Click="OpenContainingFolder_Click" />
                <MenuItem Header="Delete" Click="Delete_Click" />
                <MenuItem Header="Delete all" Click="DeleteAll_Click" />
            </ContextMenu>

            <!--Defines the context menu when a spectra file is right-clicked-->
            <ContextMenu x:Key="SpectraFileContextMenu" Style="{StaticResource ContextMenuStyle}">
                <MenuItem Header="Set file-specific parameters" Click="SetFileSpecificParameters_Click"/>
                <MenuItem Header="Open file" Click="OpenFile_Click"/>
                <MenuItem Header="Open containing folder" Click="OpenContainingFolder_Click" />
                <MenuItem Header="Delete" Click="Delete_Click" />
                <MenuItem Header="Delete all" Click="DeleteAll_Click" />
            </ContextMenu>

            <!--Defines the context menu when a task is right-clicked-->
            <ContextMenu x:Key="TaskContextMenu" Style="{StaticResource ContextMenuStyle}">
                <MenuItem Header="Edit task" Click="EditTask_Click"/>
                <MenuItem Header="Save as .toml" Click="SaveTaskAsToml_Click" />
                <MenuItem Header="Move task up" Click="MoveTaskUp_Click" />
                <MenuItem Header="Move task down" Click="MoveTaskDown_Click" />
                <MenuItem Header="Delete" Click="Delete_Click" />
                <MenuItem Header="Delete all" Click="DeleteAll_Click" />
            </ContextMenu>

            <!--Defines the context menu when a written file is right-clicked-->
            <ContextMenu x:Key="WrittenFileContextMenu" Style="{StaticResource ContextMenuStyle}">
                <MenuItem Header="Open file" Click="OpenFile_Click" />
                <MenuItem Header="Open containing folder" Click="OpenContainingFolder_Click" />
            </ContextMenu>

            <!--Styling for the datagrids that store spectra/databases-->
            <Style x:Key="x:DataGridStyle" TargetType="DataGrid">
                <Setter Property="Foreground" Value="{StaticResource TextColor1}"/>
                <Setter Property="Background" Value="{StaticResource DataGridBackgroundColor}"/>
                <Setter Property="Height" Value="Auto"/>
                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                <Setter Property="FontSize" Value="12"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
                <Setter Property="Margin" Value="10,0,10,10"/>
                <Setter Property="SelectedItem" Value="{Binding SelectedRow, Mode=TwoWay}"/>
                <Setter Property="HeadersVisibility" Value="Column"/>
                <Setter Property="HorizontalGridLinesBrush" Value="{StaticResource DataGridHeaderColor}"/>
                <Setter Property="VerticalGridLinesBrush" Value="{StaticResource DataGridHeaderColor}"/>
                <Setter Property="AutoGenerateColumns" Value="False"/>
            </Style>

            <!--Styling for the datagrid headers-->
            <Style x:Key="DataGridColumnHeaderStyle" TargetType="DataGridColumnHeader">
                <Setter Property="Background" Value="{StaticResource DataGridHeaderColor}"/>
                <Setter Property="FontSize" Value="13" />
            </Style>

            <!--Styles the spectra file datagrid items-->
            <Style x:Key="SpectraFileDataGridItemStyle" TargetType="DataGridRow">
                <EventSetter Event="Selected" Handler="AddSelectedSpectra" />
                <EventSetter Event="Unselected" Handler="RemoveSelectedSpectra" />
                <Setter Property="ContextMenu" Value="{StaticResource SpectraFileContextMenu}" />
            </Style>

            <!--Styles the protein DB datagrid items-->
            <Style x:Key="DatabaseDataGridItemStyle" TargetType="DataGridRow">
                <EventSetter Event="Selected" Handler="AddSelectedDatabase" />
                <EventSetter Event="Unselected" Handler="RemoveSelectedDatabase" />
                <Setter Property="ContextMenu" Value="{StaticResource ProteinDatabaseContextMenu}" />
            </Style>

            <Style x:Key="DataGridCellStyle" TargetType="DataGridCell">
                <EventSetter Event="MouseDoubleClick" Handler="DatabaseOrSpectraFile_DoubleClick"/>
            </Style>

            <Style x:Key="SpectraFileDataGridCellStyle" TargetType="DataGridCell" BasedOn="{StaticResource DataGridCellStyle}">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding InProgress}" Value="True">
                        <Setter Property="Foreground" Value="Blue" />
                        <Setter Property="FontWeight" Value="Bold" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <!--Data templates for the types displayed in the treeview-->
            <HierarchicalDataTemplate DataType="{x:Type local:InRunTask}" ItemsSource="{Binding Children}">
                <StackPanel Orientation="Horizontal" ContextMenu="{StaticResource TaskContextMenu}">
                    <TextBlock Text="T " />
                    <TextBlock Text="{Binding DisplayName}" />
                    <ProgressBar Value="{Binding Progress}" IsIndeterminate="{Binding IsIndeterminate}" Width="100" Margin="5,0,5,0" />
                    <TextBlock Text="{Binding Status}" />
                </StackPanel>
            </HierarchicalDataTemplate>
            <HierarchicalDataTemplate DataType="{x:Type local:CollectionForTreeView}" ItemsSource="{Binding Children}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="C " />
                    <TextBlock Text="{Binding DisplayName}" />
                    <ProgressBar Value="{Binding Progress}" IsIndeterminate="{Binding IsIndeterminate}" Width="100" Margin="5,0,5,0" />
                    <TextBlock Text="{Binding Status}" />
                </StackPanel>
            </HierarchicalDataTemplate>
            <DataTemplate DataType="{x:Type local:OutputFileForTreeView}">
                <StackPanel Orientation="Horizontal" ContextMenu="{StaticResource WrittenFileContextMenu}">
                    <TextBlock Text="F " />
                    <TextBlock Text="{Binding DisplayName}" />
                    <TextBlock Text="{Binding Status}" />
                </StackPanel>
            </DataTemplate>
            <DataTemplate DataType="{x:Type local:PreRunTask}">
                <StackPanel Orientation="Horizontal" ContextMenu="{StaticResource TaskContextMenu}">
                    <TextBlock Text="{Binding DisplayName}" />
                </StackPanel>
            </DataTemplate>
        </ResourceDictionary>
    </Window.Resources>
    <!--Window content-->
    <Grid ContextMenu="{StaticResource BigDeleteContextMenu}">
        <Grid.RowDefinitions>
            <RowDefinition Height="1*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <!--Pages-->
        <TabControl x:Name="MainWindowTabControl" Grid.Row="0" TabStripPlacement="Left" Margin="0" SelectionChanged="TabControl_SelectionChanged" 
                    BorderThickness="0" BorderBrush="{StaticResource BorderColor}" Style="{StaticResource TabControlStyle}">
            <TabControl.Resources>
                <Style TargetType="Grid">
                    <!--This defines the *default* style for *all grids in the entire tab control*-->
                    <!--This is not great but seems necessary to have a proper background on the tab items...-->
                    <Setter Property="Background" Value="{StaticResource SideBarMainColor}" />
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding Source={x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}, Path=IsRnaMode}" Value="True">
                            <Setter Property="Background" Value="{StaticResource RnaSideBarMainColor}"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </TabControl.Resources>

            <!--About tab-->
            <TabItem Name="AboutTab" Header="About" TabIndex="0" Style="{StaticResource TabItemStyle}">
                <Grid Style="{StaticResource PageGridStyle}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="60" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!--Header label-->
                    <Label Content="About" Grid.Row="0" Style="{StaticResource HeaderLabelStyle}" />

                    <!--Text content-->
                    <TextBlock Grid.Row="1" Style="{StaticResource TextBlockStyle}" Margin="14 0">
                        <Run>
                            <Run.Text>
                                <Binding Path="IsRnaMode"
                                         Source="{x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}"
                                         Converter="{StaticResource ProteinRnaTerminologyConverter}"
                                         ConverterParameter="MetaMorpheus is a search program for MS/MS proteomic data. It takes a protein database (.xml or .fasta) as input, as well as spectra files in ms2.msalign, .mzML, .mgf, or Thermo .raw format. Optionally, a spectral library (.msp) can be used to improve search results." />
                            </Run.Text>
                        </Run>

                        <LineBreak />
                        <LineBreak />

                        <Run>
                            <Run.Text>
                                <Binding Path="IsRnaMode"
                                         Source="{x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}"
                                         Converter="{StaticResource ProteinRnaTerminologyConverter}"
                                         ConverterParameter="After adding input files, the last step is to define a workflow by adding tasks for MetaMorpheus to perform." />
                            </Run.Text>
                        </Run>

                        <LineBreak />
                        <LineBreak />

                        <Run Text="● The " />

                        <Hyperlink NavigateUri="https://pubs.acs.org/doi/10.1021/acs.jproteome.7b00873"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            calibration
                        </Hyperlink>

                        <Run Text=" task performs mass calibration; " />

                        <LineBreak />

                        <Run Text="● The " />

                        <Hyperlink NavigateUri="https://pubmed.ncbi.nlm.nih.gov/38487981/"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            averaging
                        </Hyperlink>

                        <Run Text=" task averages spectra to refine isotopic distributions" />

                        <LineBreak />

                        <Run Text="● The " />
                        <Hyperlink NavigateUri="https://pubs.acs.org/doi/10.1021/acs.jproteome.6b00034"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            GPTMD
                        </Hyperlink>

                        <Run>
                            <Run.Text>
                                <Binding Path="IsRnaMode"
                                         Source="{x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}"
                                         Converter="{StaticResource ProteinRnaTerminologyConverter}"
                                         ConverterParameter=" task performs PTM discovery; " />
                            </Run.Text>
                        </Run>

                        <LineBreak />

                        <Run>
                            <Run.Text>
                                <Binding Path="IsRnaMode"
                                         Source="{x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}"
                                         Converter="{StaticResource ProteinRnaTerminologyConverter}"
                                         ConverterParameter="● The search task performs a proteomics database search, with " />
                            </Run.Text>
                        </Run>

                        <Hyperlink NavigateUri="https://pubs.acs.org/doi/10.1021/acs.jproteome.7b00608"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            quantification
                        </Hyperlink>
                        <Run Text=", " />
                        <Hyperlink NavigateUri="https://pubs.acs.org/doi/10.1021/acs.jproteome.9b00330"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            <Run>
                                <Run.Text>
                                    <Binding Path="IsRnaMode"
                                             Source="{x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}"
                                             Converter="{StaticResource ProteinRnaTerminologyConverter}"
                                             ConverterParameter="multi-protease" />
                                </Run.Text>
                            </Run>
                        </Hyperlink>
                        <Run Text=", and " />

                        <Hyperlink NavigateUri="http://dx.doi.org/10.2174/1574893615999200429123334"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            non-specific search
                        </Hyperlink>

                        <Run Text=" options;" />
                    </TextBlock>

                    <TextBlock Grid.Row="2" Style="{StaticResource TextBlockStyle}" Margin="14 0"
                               Visibility="{Binding Source={x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}, Path=IsRnaMode, Converter={StaticResource CollapseOnRnaModeConverter}}">
                        <Run Text="● The " />

                        <Hyperlink NavigateUri="https://pubs.acs.org/doi/10.1021/acs.jproteome.8b00141"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            XL search
                        </Hyperlink>

                        <Run>
                            <Run.Text>
                                <Binding Path="IsRnaMode"
                                         Source="{x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}"
                                         Converter="{StaticResource ProteinRnaTerminologyConverter}"
                                         ConverterParameter=" performs a search for crosslinked peptides; and " />
                            </Run.Text>
                        </Run>

                        <LineBreak />

                        <Run Text="● The " />

                        <Hyperlink NavigateUri="https://www.biorxiv.org/content/10.1101/2020.05.18.102327v1.abstract"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            glycopeptide
                        </Hyperlink>

                        <Run>
                            <Run.Text>
                                <Binding Path="IsRnaMode"
                                         Source="{x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}"
                                         Converter="{StaticResource ProteinRnaTerminologyConverter}"
                                         ConverterParameter=" search detects O-linked glycopeptides." />
                            </Run.Text>
                        </Run>

                        <LineBreak />
                        <LineBreak />
                    </TextBlock>

                    <TextBlock Grid.Row="3" Style="{StaticResource TextBlockStyle}" Margin="14">
                        <Run Text="Visit the " />
                        <Hyperlink NavigateUri="https://github.com/smith-chem-wisc/MetaMorpheus/wiki"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            MetaMorpheus wiki
                        </Hyperlink>
                        <Run Text=" to learn more." />
                    </TextBlock>

                    <TextBlock Grid.Row="4" Style="{StaticResource TextBlockStyle}" VerticalAlignment="Bottom"
                               Margin="14">
                        MetaMorpheus uses Thermo's RawFileReader reading tool. Copyright © 2016 by Thermo Fisher Scientific, Inc. All rights reserved.
                    </TextBlock>
                </Grid>
            </TabItem>

            <!--Databases tab-->
            <TabItem Name="DatabasesTab" Header="Databases" TabIndex="0" Style="{StaticResource TabItemStyle}">
                <Grid Style="{StaticResource PageGridStyle}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="60"/>
                        <RowDefinition Height="60"/>
                        <RowDefinition Height="25"/>
                        <RowDefinition Height="1*"/>
                    </Grid.RowDefinitions>

                    <!--Header label-->
                    <Label Style="{StaticResource HeaderLabelStyle}" Grid.ColumnSpan="4" Grid.Row="0"  >
                        <Label.Content>
                            <Binding Converter="{StaticResource ProteinRnaTerminologyConverter}" ConverterParameter="Protein Databases and Spectral Libraries"/>
                        </Label.Content>
                    </Label>

                    <!--Detail text-->
                    <TextBlock Grid.Row="1" Style="{StaticResource TextBlockStyle}" Grid.ColumnSpan="4">
                        <Run>
                            Add 
                        </Run>
                        
                        <Hyperlink NavigateUri="https://www.uniprot.org/" RequestNavigate="Hyperlink_RequestNavigate">
                            reference proteome(s)
                        </Hyperlink> 
                        
                        <Run>
                            <Run.Text>
                                <Binding Path="IsRnaMode"
                                         Source="{x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}"
                                         Converter="{StaticResource ProteinRnaTerminologyConverter}"
                                         ConverterParameter="in .xml or .fasta format. Reference proteomes in .xml format can contain post-translational modification (PTM) locations, whereas .fasta format only contains amino acid sequences."/>
                            </Run.Text>
                        </Run>

                       <Hyperlink NavigateUri="https://chemdata.nist.gov/dokuwiki/doku.php?id=peptidew:start" RequestNavigate="Hyperlink_RequestNavigate">
                            Spectral libraries
                       </Hyperlink>

                       in .msp format can be added to improve search results.
                    </TextBlock>

                    <!--Buttons to add databases-->
                    <Button Name="DownloadUniProtDatabaseButton" Grid.Row="2" Content="DOWNLOAD PROTEOME" Visibility="Collapsed"
                        Click="DownloadUniProtDatabase_Click" Style="{StaticResource ImportantButtonStyle}" Margin="10,0,0,0" HorizontalAlignment="Left" />

                    <Button Name="OpenProteomesFolder" Grid.Row="2" Content="OPEN DATABASE FOLDER"
                        Click="OpenProteomesFolder_Click" Style="{StaticResource ImportantButtonStyle}" Margin="211,0,0,0" HorizontalAlignment="Left" />

                    <Button Name="AddDatabaseButton" Grid.Row="2" Content="+ADD DATABASE" 
                        Click="AddProteinDatabase_Click" Style="{StaticResource ImportantButtonStyle}" Margin="0,0,10,0" HorizontalAlignment="Right"/>

                    <Button Name="AddDefaultContaminantsButton" Grid.Row="2" Content="+ADD DEFAULT CONTAMINANTS" 
                        Click="AddDefaultContaminantDatabase_Click" Style="{StaticResource ImportantButtonStyleNotForRna}" Margin="0,0,211,0" HorizontalAlignment="Right">
                    </Button>

                    <!--The list of databases-->
                    <DataGrid Name="dataGridProteinDatabases" Grid.Row="3" Grid.ColumnSpan="4" ItemsSource="{Binding}" Style="{StaticResource x:DataGridStyle}"
                              ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyle}" PreviewKeyDown="BoxWithList_PreviewKeyDown" >
                        <DataGrid.RowStyle>
                            <Style TargetType="{x:Type DataGridRow}" BasedOn="{StaticResource DatabaseDataGridItemStyle}" />
                        </DataGrid.RowStyle>
                        <DataGrid.CellStyle>
                            <Style TargetType="{x:Type DataGridCell}" BasedOn="{StaticResource DataGridCellStyle}" />
                        </DataGrid.CellStyle>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="File" Binding="{Binding FileName, Mode=OneWay}" Width="366" />
                            <DataGridTextColumn Header="File Path" Binding="{Binding FilePath, Mode=OneWay}" Width="160" />
                            <DataGridCheckBoxColumn Header="Contaminant?" Binding="{Binding Contaminant, Mode=TwoWay}" MinWidth="90" />
                            <DataGridCheckBoxColumn Header="Use?" Binding="{Binding Use, Mode=TwoWay}" MinWidth="80"/>
                            <DataGridTextColumn Header="Decoy Identifier" Binding="{Binding DecoyIdentifier, Mode=TwoWay}" Width="160"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!--Spectra tab-->
            <TabItem Name="SpectraTab" Header="Spectra" TabIndex="0" Style="{StaticResource TabItemStyle}">
                <Grid Style="{StaticResource PageGridStyle}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="50"/>
                        <RowDefinition Height="50"/>
                        <RowDefinition Height="25"/>
                        <RowDefinition Height="1*"/>
                    </Grid.RowDefinitions>

                    <!--Header label-->
                    <Label Content="Spectra" Grid.Row="0" Style="{StaticResource HeaderLabelStyle}" />

                    <!--Detail text-->
                    <TextBlock Grid.Row="1" Style="{StaticResource TextBlockStyle}">
                        Add spectra file(s) in .mzML, .mgf, Thermo .raw, ms2.msalign, or Bruker .d formats. For Bruker files, either the .tdf or .tdf_bin file inside the .d folder can be selected.
                    </TextBlock>

                    <!--Button to add spectra files-->
                    <Button Name="AddSpectraButton" Grid.Row="2" Content="+ADD SPECTRA" Click="AddSpectraFile_Click" HorizontalAlignment="Right" 
                            Style="{StaticResource ImportantButtonStyle}" Margin="0,0,10,0"/>

                    <Button Name="SetFileSpecificSettingsButton" Grid.Row="2" Content="SET FILE-SPECIFIC SETTINGS" Click="SetFileSpecificParameters_Click" 
                            HorizontalAlignment="Right" Style="{StaticResource ImportantButtonStyle}"
                        Margin="0,0,211,0"/>

                    <Button Name="SetExperimentalDesignButton" Grid.Row="2" Content="SET EXPERIMENTAL DESIGN" Click="SetExperimentalDesign_Click" 
                            HorizontalAlignment="Right" Style="{StaticResource ImportantButtonStyle}"
                        Margin="0,0,412,0"/>

                    <!--The list of spectra files-->
                    <DataGrid Name="dataGridSpectraFiles" ItemsSource="{Binding}" Grid.Row="3" Style="{StaticResource x:DataGridStyle}"
                              ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyle}" PreviewKeyDown="BoxWithList_PreviewKeyDown">
                        <DataGrid.RowStyle>
                            <Style TargetType="{x:Type DataGridRow}" BasedOn="{StaticResource SpectraFileDataGridItemStyle}" />
                        </DataGrid.RowStyle>
                        <DataGrid.CellStyle>
                            <Style TargetType="{x:Type DataGridCell}" BasedOn="{StaticResource SpectraFileDataGridCellStyle}" />
                        </DataGrid.CellStyle>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="File" Binding="{Binding FileName, Mode=OneWay}" Width="250" />
                            <DataGridTextColumn Header="File Path" Binding="{Binding FilePath, Mode=OneWay}" Width="200" />
                            <DataGridTextColumn Header="File-Specific Parameters" Binding="{Binding Parameters, Mode=OneWay}" Width="250" />
                            <DataGridCheckBoxColumn Header="Use?" Binding="{Binding Use, Mode=TwoWay}"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!--Workflow tab-->
            <TabItem Name="TasksTab" Header="Tasks" TabIndex="0" Style="{StaticResource TabItemStyle}">
                <Grid Style="{StaticResource PageGridStyle}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="50"/>
                        <RowDefinition Height="50"/>
                        <RowDefinition Height="25"/>
                        <RowDefinition Height="1*"/>
                    </Grid.RowDefinitions>

                    <!--Header label-->
                    <Label Content="Tasks" Grid.Row="0" Style="{StaticResource HeaderLabelStyle}" />

                    <!--Detail text-->
                    <TextBlock Grid.Row="1" Style="{StaticResource TextBlockStyle}">
                        Add MetaMorpheus tasks to construct a workflow. Tasks can be saved/loaded as .toml files for repeat use.
                    </TextBlock>

                    <!--Button to add tasks-->
                    <Grid Grid.Row="2" Background="{StaticResource BackgroundColor}" Margin="0,0,10,0" HorizontalAlignment="Right">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="140"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="140"/>
                            <ColumnDefinition Width="140"/>
                            <ColumnDefinition Width="140"/>
                            <ColumnDefinition Width="140"/>
                        </Grid.ColumnDefinitions>

                        <Button Name="AddCalibTaskButton" Grid.Column="0" Content="+ADD CALIBRATION" HorizontalAlignment="Right" Click="AddCalibrateTaskButton_Click" 
                            Style="{StaticResource ImportantButtonStyle}" Margin="0,0,1,0" Width="140"/>
                        <Button Name="AddAveragingTaskButton" Grid.Column="1" Content="+AVERAGE SPECTRA" HorizontalAlignment="Right" Click="AddAveragingTaskButton_OnClick" 
                                Style="{StaticResource ImportantButtonStyle}" Margin="0, 0, 1, 0" Width="140" FontSize="11" Visibility="Visible"/>
                        <Button Name="AddGptmdTaskButton" Grid.Column="2" Content="+ADD PTM DISCOVERY" HorizontalAlignment="Right" Click="AddGPTMDTaskButton_Click" 
                            Style="{StaticResource ImportantButtonStyle}" Margin="0,0,1,0" Width="140"/>
                        <Button Name="AddSearchTaskButton" Grid.Column="3" Content="+ADD SEARCH" HorizontalAlignment="Right" Click="AddSearchTaskButton_Click" 
                            Style="{StaticResource ImportantButtonStyle}" Margin="0,0,1,0" Width="140"/>
                        <Button Name="AddXlTaskButton" Grid.Column="4" Content="+ADD XL SEARCH" HorizontalAlignment="Right" Click="AddCrosslinkTask_Click" 
                            Style="{StaticResource ImportantButtonStyleNotForRna}" Margin="0,0,1,0" Width="140"/>
                        <Button Name="AddGlycoTaskButton" Grid.Column="5" Content="+ADD GLYCO SEARCH" HorizontalAlignment="Right" Click="AddGlycoSearchTask_Click" 
                            Style="{StaticResource ImportantButtonStyleNotForRna}" Margin="0,0,0,0" Width="140"/>
                    </Grid>

                    <!--List of tasks-->
                    <TreeView x:Name="tasksTreeView" Grid.Row="3" ItemsSource="{Binding}" MouseDoubleClick="TasksTreeView_MouseDoubleClick" 
                              Margin="10,0,10,10" BorderBrush="{StaticResource BorderColor}" PreviewKeyDown="BoxWithList_PreviewKeyDown">
                    </TreeView>
                </Grid>
            </TabItem>

            <!--Run tab-->
            <TabItem Name="RunTab" Header="Run" TabIndex="0" Style="{StaticResource TabItemStyle}">
                <Grid Style="{StaticResource PageGridStyle}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="4*" />
                        <RowDefinition Height="20" />
                        <RowDefinition Height="25" />
                        <RowDefinition Height="50" />
                        <RowDefinition Height="1*" />
                    </Grid.RowDefinitions>

                    <!--This grid holds the 3 summary datagrids at the top-->
                    <Grid Grid.Row="0" Background="{StaticResource BackgroundColor}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="5*" />
                            <ColumnDefinition Width="5" />
                            <ColumnDefinition Width="4*" />
                        </Grid.ColumnDefinitions>

                        <Grid Grid.Column="0" Background="{StaticResource BackgroundColor}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="1*" />
                                <RowDefinition Height="5" />
                                <RowDefinition Height="1*" />
                            </Grid.RowDefinitions>

                            <!--Protein DB Summary-->
                            <DataGrid Name="proteinDbSummaryDataGrid" ItemsSource="{Binding}" Grid.Row="0" Margin="20,10,0,0" 
                              Style="{StaticResource x:DataGridStyle}" ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyle}" PreviewKeyDown="BoxWithList_PreviewKeyDown">
                                <DataGrid.RowStyle>
                                    <Style TargetType="{x:Type DataGridRow}" BasedOn="{StaticResource DatabaseDataGridItemStyle}" >
                                        <Setter Property="FontSize" Value="11" />
                                        <Setter Property="FontWeight" Value="SemiBold" />
                                    </Style>
                                </DataGrid.RowStyle>
                                <DataGrid.CellStyle>
                                    <Style TargetType="{x:Type DataGridCell}" BasedOn="{StaticResource DataGridCellStyle}" />
                                </DataGrid.CellStyle>
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="File" Binding="{Binding FileName, Mode=OneWay}" Width="230" />
                                    <DataGridCheckBoxColumn Header="Use?" Binding="{Binding Use, Mode=TwoWay}" MinWidth="40"/>
                                    <DataGridCheckBoxColumn Header="Contaminant?" Binding="{Binding Contaminant, Mode=TwoWay}" MinWidth="90"/>
                                    <DataGridTextColumn Header="Decoy Identifier" Binding="{Binding DecoyIdentifier, Mode=TwoWay}" Width="160" />
                                </DataGrid.Columns>
                            </DataGrid>
                            <Button Name="MiniAddProteinDbButton" Grid.Row="0" Width="20" Height="20" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,1,1" Content="+" 
                                VerticalContentAlignment="Top" Style="{StaticResource ImportantButtonStyle}" Click="AddProteinDatabase_Click"/>

                            <GridSplitter Grid.Row="1"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Stretch"
                                Background="Transparent"
                                Height="5"
                                Margin="20,0,0,0"/>

                            <!--Spectra file Summary-->
                            <DataGrid Name="spectraFileSummaryDataGrid" ItemsSource="{Binding}" Grid.Row="2" Margin="20,0,0,10" 
                              Style="{StaticResource x:DataGridStyle}" ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyle}" PreviewKeyDown="BoxWithList_PreviewKeyDown">
                                <DataGrid.RowStyle>
                                    <Style TargetType="{x:Type DataGridRow}" BasedOn="{StaticResource SpectraFileDataGridItemStyle}">
                                        <Setter Property="FontSize" Value="11" />
                                        <Setter Property="FontWeight" Value="SemiBold" />
                                    </Style>
                                </DataGrid.RowStyle>
                                <DataGrid.CellStyle>
                                    <Style TargetType="{x:Type DataGridCell}" BasedOn="{StaticResource SpectraFileDataGridCellStyle}" />
                                </DataGrid.CellStyle>
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="File" Binding="{Binding FileName, Mode=OneWay}" Width="230" />
                                    <DataGridTextColumn Header="File-Specific Parameters" Binding="{Binding Parameters, Mode=OneWay}" Width="170" />
                                    <DataGridCheckBoxColumn Header="Use?" Binding="{Binding Use, Mode=TwoWay}"/>
                                </DataGrid.Columns>
                            </DataGrid>
                            <Button Name="MiniAddSpectraButton" Grid.Row="2" Width="20" Height="20" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,1,11" Content="+" 
                                VerticalContentAlignment="Top" Style="{StaticResource ImportantButtonStyle}" Click="AddSpectraFile_Click"/>
                        </Grid>

                        <GridSplitter Grid.Column="1"
                            VerticalAlignment="Stretch"
                            HorizontalAlignment="Center"
                            Background="Transparent"
                            Width="10"
                            Margin="0,10,0,10"/>

                        <!--Task Summary-->
                        <TreeView Name="taskSummary" ItemsSource="{Binding}" Grid.Column="2" Margin="0,10,20,10" MouseDoubleClick="TasksTreeView_MouseDoubleClick"
                                  PreviewKeyDown="BoxWithList_PreviewKeyDown">
                            <TreeView.ItemContainerStyle>
                                <Style TargetType="{x:Type TreeViewItem}">
                                    <Setter Property="FontSize" Value="13" />
                                    <Setter Property="FontWeight" Value="SemiBold" />
                                </Style>
                            </TreeView.ItemContainerStyle>
                        </TreeView>
                        <Button Name="MiniAddTaskButton" Grid.Column="2" Width="20" Height="20" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,21,11" Content="+" 
                                VerticalContentAlignment="Top" Style="{StaticResource ImportantButtonStyle}" Click="AddTask_Click"/>
                    </Grid>

                    <!--Define/open output folder-->
                    <DockPanel Margin="5,0,10,0" Grid.Row="2" LastChildFill="True">
                        <Button x:Name="OpenOutputFolderButton" Content="OPEN" Width="60" DockPanel.Dock="Right" 
                                    Click="OpenOutputFolder_Click" Background="{StaticResource SecondaryButtonColor}" Foreground="White" FontSize="12" 
                                BorderThickness="0" />

                        <Label Content="Output Folder:" Foreground="{StaticResource TextColor1}" FontSize="12" />

                        <TextBox x:Name="OutputFolderTextBox" ToolTip="$DATETIME is automatically replaced by the current date and time" 
                             Background="Transparent" Foreground="{StaticResource TextColor1}" BorderBrush="{StaticResource BorderColor}" BorderThickness="1" 
                                 FontSize="13"/>
                    </DockPanel>

                    <Grid Grid.Row="3" Background="{StaticResource BackgroundColor}">
                        <!--Run button-->
                        <Button x:Name="RunTasksButton" Content="RUN METAMORPHEUS" Click="RunAllTasks_Click" FontSize="14" Margin="10" Height="30"
                                Width="200" Style="{StaticResource ImportantButtonStyle}" />

                        <Button x:Name="ResetTasksButton" Content="RESET TASKS" Click="ResetTasks_Click" FontSize="14" Margin="210,10,10,10" Height="30"
                                Width="200" Style="{StaticResource ImportantButtonStyle}" />

                        <Button x:Name="CancelTasksButton" Content="CANCEL RUN" Click="CancelTasks_Click" FontSize="14" Margin="-210,10,10,10" Height="30"
                                Width="200" Style="{StaticResource ImportantButtonStyle}" />
                    </Grid>
                </Grid>
            </TabItem>

            <!--Spacer-->
            <TabItem Style="{StaticResource TabItemStyle}" IsHitTestVisible="False">
                <TabItem.Header>
                    <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Background="{StaticResource SideBarMainColor}" />
                </TabItem.Header>
            </TabItem>

            <!--Visualize tab-->
            <TabItem Name="VisualizeTab" Header="Visualize" TabIndex="0" Style="{StaticResource TabItemStyle}">
                <Grid Style="{StaticResource PageGridStyle}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="50"/>
                        <RowDefinition Height="25"/>
                        <RowDefinition Height="1*"/>
                    </Grid.RowDefinitions>

                    <!--Header label-->
                    <Label Content="Visualize" Grid.Row="0" Style="{StaticResource HeaderLabelStyle}" />

                    <!--This tab doesn't actually have any content, it just opens MetaDraw-->
                    <!--In the future maybe this tab could contain MetaDraw itself-->

                    <TextBlock Grid.Row="3" Style="{StaticResource TextBlockStyle}">
                            MetaDraw, MetaMorpheus's spectral viewer, will open in a new window.
                    </TextBlock>
                </Grid>
            </TabItem>

            <!--Settings tab-->
            <TabItem Name="SettingsTab" Header="Settings" TabIndex="0" Style="{StaticResource TabItemStyle}">
                <Grid Style="{StaticResource PageGridStyle}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="50"/>
                        <RowDefinition Height="25"/>
                        <RowDefinition Height="1*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!--Header label-->
                    <Label Content="Settings" Grid.Row="0" Style="{StaticResource HeaderLabelStyle}" />

                    <Grid Grid.Row="2" Style="{StaticResource PageGridStyle}" Margin="5,0,0,0">

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="300"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Left: Existing buttons -->
                        <Grid Grid.Column="0" Style="{StaticResource PageGridStyle}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="22"/>
                                <RowDefinition Height="22"/>
                                <RowDefinition Height="22"/>
                                <RowDefinition Height="22"/>
                                <RowDefinition Height="22"/>
                                <RowDefinition Height="22"/>
                                <RowDefinition Height="22"/>
                                <RowDefinition Height="22"/>
                                <RowDefinition Height="22"/>
                                <RowDefinition Height="22"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="270"/>
                            </Grid.ColumnDefinitions>

                            <Button Grid.Row="0" Grid.Column="1" Content="Create new modification" 
                                    HorizontalContentAlignment="Left" BorderThickness="0" Click="AddCustomMod_Click" />

                            <Button Grid.Row="1" Grid.Column="1" Content="Create new amino acid" 
                                    HorizontalContentAlignment="Left" BorderThickness="0" Click="AddCustomAminoAcid_Click" />

                            <Button Grid.Row="2" Grid.Column="1" Content="Create new crosslinker" 
                                    HorizontalContentAlignment="Left" BorderThickness="0" Click="AddCustomCrosslinker_Click" />

                            <Button Grid.Row="4" Grid.Column="1" Content="Close program and open global settings" 
                                    HorizontalContentAlignment="Left" BorderThickness="0" Click="MenuItem_OpenSettings_Click" />

                            <Button Grid.Row="5" Grid.Column="1" Content="Open mods/data folder" 
                                    HorizontalContentAlignment="Left" BorderThickness="0" Click="MenuItem_OpenDataDir_Click" />

                            <Button Grid.Row="6" Grid.Column="1" Content="Reset to factory defaults" 
                                    HorizontalContentAlignment="Left" BorderThickness="0" Click="MenuItem_ResetDefaults_Click"
                                    ToolTip="Reset saved tasks and MetaDraw Settings to default values"/>

                            <CheckBox Grid.Row="8" Grid.Column="1" Content="Ask About Updating" 
                                     FontSize="13" VerticalAlignment="Center" VerticalContentAlignment="Center"
                                     IsChecked="{Binding Source={x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}, Path=AskAboutUpdating, Mode=TwoWay}" />

                            <CheckBox Grid.Row="9" Grid.Column="1" Content="Ask Before Exiting MetaMorpheus" 
                                     FontSize="13" VerticalAlignment="Center" VerticalContentAlignment="Center"
                                     IsChecked="{Binding Source={x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}, Path=AskBeforeExitingMetaMorpheus, Mode=TwoWay}" />
                            <CheckBox Grid.Row="10" Grid.Column="1" Content="Rna Mode" 
                                         FontSize="13" VerticalAlignment="Center" VerticalContentAlignment="Center"
                                         IsChecked="{Binding Source={x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}, Path=IsRnaMode, Mode=TwoWay}" />
                        </Grid>

                        <!-- Right: New settings controls -->
                        <Grid Grid.Column="1" Style="{StaticResource PageGridStyle}"
                                  DataContext="{x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}"
                                  Margin="20,-10,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="24" />
                                <RowDefinition Height="24" />
                                <RowDefinition Height="24" />
                                <RowDefinition Height="24" />
                                <RowDefinition Height="24" />
                                <RowDefinition Height="24" />
                                <RowDefinition Height="24" />
                                <RowDefinition Height="24"/>
                                <RowDefinition Height="24"/>
                                <RowDefinition Height="24"/>
                                <RowDefinition Height="24"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="280"/>
                                <ColumnDefinition Width="80"/>
                                <ColumnDefinition Width="160"/>
                            </Grid.ColumnDefinitions>

                            <!-- Ask/Use pairs -->
                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Top-Down Recommendations" 
                                           VerticalAlignment="Center" Style="{StaticResource TextBlockStyle}"/>
                            <CheckBox Grid.Row="0" Grid.Column="1" Content="Ask" IsChecked="{Binding AskAboutTopDownParams, Mode=TwoWay}" VerticalAlignment="Center"/>
                            <CheckBox Grid.Row="0" Grid.Column="2" Content="Use" IsChecked="{Binding UseTopDownParams, Mode=TwoWay}" VerticalAlignment="Center"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Chymotrypsin Recommendations" 
                                           VerticalAlignment="Center" Style="{StaticResource TextBlockStyle}"/>
                            <CheckBox Grid.Row="1" Grid.Column="1" Content="Ask" IsChecked="{Binding AskAboutChymotrypsinParams, Mode=TwoWay}" VerticalAlignment="Center"/>
                            <CheckBox Grid.Row="1" Grid.Column="2" Content="Use" IsChecked="{Binding UseChymotrypsinParams, Mode=TwoWay}" VerticalAlignment="Center"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Elastase Recommendations" 
                                           VerticalAlignment="Center" Style="{StaticResource TextBlockStyle}"/>
                            <CheckBox Grid.Row="2" Grid.Column="1" Content="Ask" IsChecked="{Binding AskAboutElastaseParams, Mode=TwoWay}" VerticalAlignment="Center"/>
                            <CheckBox Grid.Row="2" Grid.Column="2" Content="Use" IsChecked="{Binding UseElastaseParams, Mode=TwoWay}" VerticalAlignment="Center"/>

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Non-Specific Recommendations" 
                                           VerticalAlignment="Center" Style="{StaticResource TextBlockStyle}"/>
                            <CheckBox Grid.Row="3" Grid.Column="1" Content="Ask" IsChecked="{Binding AskAboutNonSpecificParams, Mode=TwoWay}" VerticalAlignment="Center"/>
                            <CheckBox Grid.Row="3" Grid.Column="2" Content="Use" IsChecked="{Binding UseNonSpecificParams, Mode=TwoWay}" VerticalAlignment="Center"/>

                            <TextBlock Grid.Row="4" Grid.Column="0" Text="Semi-Trypsin Recommendations" 
                                           VerticalAlignment="Center" Style="{StaticResource TextBlockStyle}"/>
                            <CheckBox Grid.Row="4" Grid.Column="1" Content="Ask" IsChecked="{Binding AskAboutSemiTrypsinParams, Mode=TwoWay}" VerticalAlignment="Center"/>
                            <CheckBox Grid.Row="4" Grid.Column="2" Content="Use" IsChecked="{Binding UseSemiTrypsinParams, Mode=TwoWay}" VerticalAlignment="Center"/>

                            <TextBlock Grid.Row="5" Grid.Column="0" Text="Arg-C Recommendations"
                                           VerticalAlignment="Center" Style="{StaticResource TextBlockStyle}"/>
                            <CheckBox Grid.Row="5" Grid.Column="1" Content="Ask" IsChecked="{Binding AskAboutArgCParams, Mode=TwoWay}" VerticalAlignment="Center"/>
                            <CheckBox Grid.Row="5" Grid.Column="2" Content="Use" IsChecked="{Binding UseArgCParams, Mode=TwoWay}" VerticalAlignment="Center"/>

                            <TextBlock Grid.Row="6" Grid.Column="0" Text="Spectral Recovery Recommendations" 
                                           VerticalAlignment="Center" Style="{StaticResource TextBlockStyle}"/>
                            <CheckBox Grid.Row="6" Grid.Column="1" Content="Ask" IsChecked="{Binding AskAboutSpectralRecoveryParams, Mode=TwoWay}" VerticalAlignment="Center"/>
                            <CheckBox Grid.Row="6" Grid.Column="2" Content="Use" IsChecked="{Binding UseSpectralRecoveryParams, Mode=TwoWay}" VerticalAlignment="Center"/>
                            
                            <TextBlock Grid.Row="7" Grid.Column="0" Text="Protein/RNA Mode Switching Prompt" 
                                       VerticalAlignment="Center" Style="{StaticResource TextBlockStyle}"/>
                            <CheckBox Grid.Row="7" Grid.Column="1" Content="Ask" IsChecked="{Binding AskAboutModeSwitch, Mode=TwoWay}" VerticalAlignment="Center"/>
                            <ComboBox Grid.Row="7" Grid.Column="2" VerticalAlignment="Center" Width="154" HorizontalAlignment="Left"
                                      ItemsSource="{Binding AllModeSwitchValues}"
                                      SelectedItem="{Binding CachedModeSwitchResult, Mode=TwoWay}" />
                        </Grid>
                    </Grid>

                    <!-- Proteome Directory -->
                    <StackPanel Grid.Row="3"  Orientation="Horizontal" HorizontalAlignment="Stretch">
                        <TextBlock  Text="Database Directory" Margin ="24 10"
                                    VerticalAlignment="Center" Style="{StaticResource TextBlockStyle}"/>
                        <TextBox  FontSize="12" FontWeight="SemiBold" TextWrapping="Wrap"
                            Text="{Binding Source={x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}, Path=ProteomeDirectory, Mode=TwoWay}" 
                            VerticalAlignment="Center" HorizontalContentAlignment="Left"
                            MinWidth="600" MaxWidth="700"/>
                </StackPanel>
                </Grid>
            </TabItem>

            <!--Help tab-->
            <TabItem Name="HelpTab" Header="Help" TabIndex="0" Style="{StaticResource TabItemStyle}">
                <Grid Style="{StaticResource PageGridStyle}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="50"/>
                        <RowDefinition Height="25"/>
                        <RowDefinition Height="1*"/>
                        <RowDefinition Height="1*"/>
                    </Grid.RowDefinitions>

                    <!--Header label-->
                    <Label Content="Help" Grid.Row="0" Style="{StaticResource HeaderLabelStyle}" />

                    <TextBlock Grid.Row="2" Style="{StaticResource TextBlockStyle}">
                        Please visit our 
                        <Hyperlink NavigateUri="https://github.com/smith-chem-wisc/MetaMorpheus/wiki" RequestNavigate="Hyperlink_RequestNavigate">
                            wiki
                        </Hyperlink>  
                        to find answers to commonly-asked questions.
                        
                        <LineBreak/>
                        <LineBreak/>
                        
                        If you encounter problems or you have a suggestion, please visit  
                        <Hyperlink NavigateUri="https://github.com/smith-chem-wisc/MetaMorpheus/issues/new" RequestNavigate="Hyperlink_RequestNavigate">
                            our issues page
                        </Hyperlink> 
                        on GitHub and submit a new issue. 
                        
                        <LineBreak/>
                        <LineBreak/>
                        
                        If you would prefer to keep your correspondence private, you may email us at 
                        <Hyperlink NavigateUri="null" RequestNavigate="MenuItem_EmailHelp_Click">
                            mm_support@chem.wisc.edu
                        </Hyperlink>.
                    </TextBlock>

                    <Grid Grid.Row="3" Style="{StaticResource PageGridStyle}" Margin="5,0,0,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="22"/>
                            <RowDefinition Height="22"/>
                            <RowDefinition Height="22"/>
                            <RowDefinition Height="22"/>
                            <RowDefinition Height="22"/>
                            <RowDefinition Height="22"/>
                            <RowDefinition Height="22"/>
                            <RowDefinition Height="22"/>
                        </Grid.RowDefinitions>

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="330"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="1" Style="{StaticResource TextBlockStyle}" Margin="0">
                            You may also want to:
                        </TextBlock>

                        <Button Grid.Row="1" Grid.Column="1" HorizontalContentAlignment="Left" BorderThickness="0" Click="MenuItem_UpdateMetaMorpheus_Click">
                            <StackPanel Orientation="Horizontal">
                                <Image Source="Icons/update_20.bmp" Width="20" Height="20" Margin="0,0,5,0"/>
                                <TextBlock Text="Check for MetaMorpheus updates" VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>

                        <Button Grid.Row="2" Grid.Column="1" HorizontalContentAlignment="Left" BorderThickness="0" Click="MenuItem_Slack_Click">
                            <StackPanel Orientation="Horizontal">
                                <Image Source="Icons/Slack_Mark_Web.bmp" Width="20" Height="20" Margin="0,0,5,0"/>
                                <TextBlock Text="Join the discussion on Slack" VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>

                        <Button Grid.Row="3" Grid.Column="1" HorizontalContentAlignment="Left" BorderThickness="0" Click="MenuItem_Twitter_Click">
                            <StackPanel Orientation="Horizontal">
                                <Image Source="Icons/Twitter_Logo_Blue.bmp" Width="20" Height="20" Margin="0,0,5,0"/>
                                <TextBlock Text="Follow us on Twitter" VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>

                        <Button Grid.Row="4" Grid.Column="1" HorizontalContentAlignment="Left" BorderThickness="0" Click="MenuItem_YouTube_Click">
                            <StackPanel Orientation="Horizontal">
                                <Image Source="Icons/youtube_20.bmp" Width="20" Height="20" Margin="0,0,5,0"/>
                                <TextBlock Text="Watch YouTube help videos" VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>

                        <Button Grid.Row="5" Grid.Column="1" HorizontalContentAlignment="Left" BorderThickness="0" Click="MenuItem_Proxl_Click">
                            <StackPanel Orientation="Horizontal">
                                <Image Source="Icons/proxl-ms.bmp" Width="20" Height="20" Margin="0,0,5,0"/>
                                <TextBlock Text="Visualize crosslinks with proxl" VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>

                        <Button Grid.Row="6" Grid.Column="1" HorizontalContentAlignment="Left" BorderThickness="0" Click="MenuItem_Spritz_Click">
                            <StackPanel Orientation="Horizontal">
                                <Image Source="/Icons/spritz20.png" Width="20" Height="20" Margin="0,0,5,0"/>
                                <TextBlock Text="Create sample-specific database with Spritz" VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>

                        <Button Grid.Row="7" Grid.Column="1" HorizontalContentAlignment="Left" BorderThickness="0" Click="MenuItem_ProteomicsNewsBlog_Click">
                            <StackPanel Orientation="Horizontal">
                                <Image Source="Icons/Blogger_20.bmp" Width="20" Height="20" Margin="0,0,5,0"/>
                                <TextBlock Text="Read News in Proteomics Research" VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>
                    </Grid>

                </Grid>
            </TabItem>
        </TabControl>

        <!--Notifications-->
        <Grid Grid.Row="1" Margin="0,-1,0,0" >
            <Grid.Resources>
                <Style TargetType="Grid">
                    <Setter Property="Background" Value="{StaticResource SideBarMainColor}" />
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding Source={x:Static guiFunctions:GuiGlobalParamsViewModel.Instance}, Path=IsRnaMode}" Value="True">
                            <Setter Property="Background" Value="{StaticResource RnaSideBarMainColor}"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Grid.Resources>
            
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="105" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="1" Background="{StaticResource BackgroundColor}" Margin="1,0,0,0">
                <Expander x:Name="NotificationExpander" Background="{StaticResource BackgroundColor}" FlowDirection="RightToLeft" >
                    <Expander.Header>
                        <StackPanel>
                            <TextBlock>Notifications</TextBlock>
                        </StackPanel>
                    </Expander.Header>

                    <RichTextBox x:Name="notificationsTextBox" VerticalScrollBarVisibility="Visible" IsReadOnly="True" 
                                 Background="Transparent" Foreground="{StaticResource TextColor1}" Height="100" BorderThickness="1" FlowDirection="LeftToRight">
                        <RichTextBox.Resources>
                            <Style TargetType="{x:Type Paragraph}">
                                <Setter Property="Margin" Value="0" />
                            </Style>
                        </RichTextBox.Resources>
                    </RichTextBox>
                </Expander>
            </StackPanel>
        </Grid>
    </Grid>
</Window>